<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ç¬¬4é—œï¼šç³§é£Ÿè¿·å®®æŒ‘æˆ°</title>
  <style>
    body {
      font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
      background-color: #fefae0;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #4e7525;
    }
    #maze {
      display: grid;
      grid-template-columns: repeat(10, 40px);
      grid-template-rows: repeat(10, 40px);
      gap: 2px;
      justify-content: center;
      margin: 30px auto;
    }
    .cell {
      width: 40px;
      height: 40px;
      background-color: #eee;
      border: 1px solid #ccc;
      background-size: cover;
      background-position: center;
    }
    .wall {
      background-color: #555;
    }
    .goal {
      background-image: url('images/villageB.png');
    }
    .player {
      background-image: url('images/player.png');
    }
    .food {
      background-image: url('images/banana.png');
    }
    .door {
      background-image: url('images/door.png');
    }
    .button {
      background-image: url('images/button.png');
    }
    #message {
      font-size: 1.2em;
      margin-top: 20px;
      color: #333;
    }
    #nextLevelBtn button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1em;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #nextLevelBtn button:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <h1>ç¬¬4é—œï¼šç³§é£Ÿè¿·å®®æŒ‘æˆ°</h1>
  <p>ä½¿ç”¨æ–¹å‘éµç§»å‹•ï¼Œå…ˆå–å¾—é£Ÿç‰©ï¼Œå†æŒ‰ä¸‹é–‹é—œï¼Œæ‰èƒ½æ‰“é–‹æ‘èŠå‰çš„é–€ä¸¦æˆåŠŸé€é”ï¼</p>

  <div id="maze"></div>
  <div id="message"></div>
  <div id="nextLevelBtn" hidden>
    <button onclick="goToNextLevel()">å‰å¾€ç¬¬5é—œ</button>
  </div>

  <script>
    let mazeMap = [
      "##########",
      "#........#",
      "#.######.#",
      "#.#..B.#.#",
      "#.#.##.#.#",
      "#...##...#",
      "###.####.#",
      "#........#",
      "#F######D#",
      "########G#"
    ];

    const maze = document.getElementById('maze');
    const message = document.getElementById('message');

    let playerPos = { x: 1, y: 1 };
    let hasFood = false;
    let doorOpened = false;

    function drawMaze() {
      maze.innerHTML = '';
      for (let y = 0; y < mazeMap.length; y++) {
        for (let x = 0; x < mazeMap[y].length; x++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          const tile = mazeMap[y][x];
          if (tile === '#') cell.classList.add('wall');
          if (tile === 'G') cell.classList.add('goal');
          if (tile === 'F') cell.classList.add('food');
          if (tile === 'D') cell.classList.add('door');
          if (tile === 'B') cell.classList.add('button');
          if (x === playerPos.x && y === playerPos.y) cell.classList.add('player');
          maze.appendChild(cell);
        }
      }
    }

    function movePlayer(dx, dy) {
      const newX = playerPos.x + dx;
      const newY = playerPos.y + dy;
      const tile = mazeMap[newY][newX];

      if (tile !== '#' && (tile !== 'D' || doorOpened)) {
        playerPos.x = newX;
        playerPos.y = newY;

        if (tile === 'F') {
          hasFood = true;
          mazeMap[newY] = mazeMap[newY].substring(0, newX) + '.' + mazeMap[newY].substring(newX + 1);
          message.textContent = "âœ… ä½ å·²å–å¾—é£Ÿç‰©ï¼Œå¿«é€å»æ‘èŠï¼";
        }

        if (tile === 'B') {
          doorOpened = true;
          mazeMap[newY] = mazeMap[newY].substring(0, newX) + '.' + mazeMap[newY].substring(newX + 1);
          mazeMap = mazeMap.map(row => row.replace('D', '.'));
          message.textContent = "ğŸ”“ ä½ æ‰“é–‹äº†é–€ï¼Œç¾åœ¨å¯ä»¥å‰å¾€æ‘èŠï¼";
        }

        if (tile === 'G') {
          if (hasFood && doorOpened) {
            message.textContent = "ğŸ‰ ä»»å‹™å®Œæˆï¼ä½ æˆåŠŸå°‡é£Ÿç‰©é€é”æ‘èŠï¼";
            document.getElementById('nextLevelBtn').hidden = false;
            window.removeEventListener('keydown', handleKey);
          } else if (!hasFood) {
            message.textContent = "âš ï¸ ä½ é‚„æ²’æœ‰æ‹¿åˆ°é£Ÿç‰©ï¼Œä¸èƒ½é€é”æ‘èŠï¼";
          } else if (!doorOpened) {
            message.textContent = "ğŸšª æ‘èŠçš„é–€é‚„æ²’æ‰“é–‹ï¼Œè«‹å…ˆå»æŒ‰é–‹é—œï¼";
          }
        }

        drawMaze();
      }
    }

    function handleKey(e) {
      switch (e.key) {
        case 'ArrowUp': movePlayer(0, -1); break;
        case 'ArrowDown': movePlayer(0, 1); break;
        case 'ArrowLeft': movePlayer(-1, 0); break;
        case 'ArrowRight': movePlayer(1, 0); break;
      }
    }

    function goToNextLevel() {
      window.location.href = "level5.html";
    }

    
window.onload = function() {
  document.getElementById("bgm").play();
  drawMaze();
};

window.addEventListener('keydown', handleKey);
    drawMaze();
  </script>
<audio id="bgm" src="Carefree.mp3" loop hidden></audio>
</body>
</html>