<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>é£¢é¤“çµ‚çµè€…</title>
  <style>
    body {
      font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
      text-align: center;
      padding: 20px;
      background-image: url("images/bgpicture.png");
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
    }
    .hidden { display: none; }
    h1 { font-size: 2.5em; color: #333; }
    .food-item, .quiz-food {
      display: inline-block;
      margin: 10px;
      padding: 10px;
      background-color: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 8px;
      cursor: pointer;
    }
    .quiz-food {
      font-size: 2em;
      width: 100px;
      height: 100px;
      line-height: 100px;
    }
    .quiz-food.disabled {
      background-color: #e0e0e0;
      pointer-events: none;
    }
    .region {
      display: inline-block;
      width: 300px;
      margin: 15px;
      padding: 15px;
      border: 2px dashed #6c757d;
      background-color: rgba(255,255,255,0.8);
      border-radius: 10px;
      vertical-align: top;
    }
    .region img.village {
      width: 100%;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    .dropzone {
      min-height: 80px;
      padding: 10px;
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .dropzone img.food {
      width: 50px;
      height: 50px;
      margin: 5px;
      object-fit: contain;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      margin-top: 20px;
      border: none;
      border-radius: 5px;
      background-color: #28a745;
      color: white;
      cursor: pointer;
    }
    button:hover { background-color: #218838; }

    #quiz-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 2px solid #ccc;
      padding: 20px;
      border-radius: 10px;
      z-index: 999;
      max-width: 300px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    #quiz-popup.hidden {
      display: none;
    }
    #quiz-options button {
      margin: 5px;
      padding: 8px 12px;
      font-size: 1em;
    }
  </style>
</head>
<body>
    <div id="level1">
    <h1>é£¢é¤“çµ‚çµè€…ï¼šåˆ†é…æŒ‘æˆ°</h1>
    <h2>ç¬¬1é—œï¼šåŸºç¤ç†±é‡é…çµ¦</h2>
    <p>è«‹å°‡é£Ÿç‰©æ‹–æ‹‰åˆ°å…©å€‹æ‘èŠä¸­ï¼Œè®“æ¯å€‹æ‘èŠç²å¾—è‡³å°‘ <strong>800 å¡</strong> ç†±é‡</p>

    <div id="food-items">
      <div class="food-item" draggable="true" data-calories="300" data-src="images/rice.png">ğŸš ç™½é£¯ (300å¡)</div>
      <div class="food-item" draggable="true" data-calories="500" data-src="images/chicken.png">ğŸ— é›è‚‰ (500å¡)</div>
      <div class="food-item" draggable="true" data-calories="200" data-src="images/vegetable.png">ğŸ¥¦ è”¬èœ (200å¡)</div>
      <div class="food-item" draggable="true" data-calories="400" data-src="images/bread.png">ğŸ éºµåŒ… (400å¡)</div>
      <div class="food-item" draggable="true" data-calories="250" data-src="images/banana.png">ğŸŒ é¦™è•‰ (250å¡)</div>
      <div class="food-item" draggable="true" data-calories="450" data-src="images/cheese.png">ğŸ§€ èµ·å¸ (450å¡)</div>
      <div class="food-item" draggable="true" data-calories="350" data-src="images/sushi.png">ğŸ£ å£½å¸ (350å¡)</div>
      <div class="food-item" draggable="true" data-calories="600" data-src="images/fries.png">ğŸŸ è–¯æ¢ (600å¡)</div>
    </div>

    <div class="region" data-goal="800">
      <h3>æ‘èŠ A</h3>
      <img src="images/villageA.png" alt="æ‘èŠ A åœ–ç‰‡" class="village">
      <div class="dropzone" id="zone-a"></div>
      <p>å·²åˆ†é…ï¼š<span class="total">0</span> å¡</p>
    </div>

    <div class="region" data-goal="800">
      <h3>æ‘èŠ B</h3>
      <img src="images/villageB.png" alt="æ‘èŠ B åœ–ç‰‡" class="village">
      <div class="dropzone" id="zone-b"></div>
      <p>å·²åˆ†é…ï¼š<span class="total">0</span> å¡</p>
    </div>

    <button onclick="checkLevel1()">ç¢ºèªåˆ†é…çµæœ</button>
  </div>

  <div id="level2" class="hidden">
    <h2>ç¬¬2é—œï¼šç‡Ÿé¤Šå‡è¡¡</h2>
    <p>è«‹ç‚ºæ¯å€‹æ‘èŠåˆ†é…é£Ÿç‰©ä¸¦ç¢ºä¿è‡³å°‘æœ‰ä¸€é …ã€Œå«è›‹ç™½è³ªã€çš„é£Ÿç‰©ã€‚<br>ä¸€å®šè¦åˆ†é…æœ‰è›‹ç™½è³ªçš„é£Ÿç‰©ä¾†ä¿æŒå…©å€‹æ‘èŠç‡Ÿé¤Šå‡è¡¡</p>
    <div id="protein-food-items">
      <div class="food-item" draggable="true" data-calories="400" data-protein="true" data-src="images/beef.png">ğŸ¥© ç‰›è‚‰</div>
      <div class="food-item" draggable="true" data-calories="300" data-protein="true" data-src="images/egg.png">ğŸ¥š é›è›‹</div>
      <div class="food-item" draggable="true" data-calories="250" data-protein="true" data-src="images/milk.png">ğŸ¥› ç‰›å¥¶</div>
      <div class="food-item" draggable="true" data-calories="500" data-protein="true" data-src="images/chicken.png">ğŸ— é›è‚‰</div>
      <div class="food-item" draggable="true" data-calories="150" data-protein="false" data-src="images/spinach.png">ğŸ¥¬ è èœ</div>
      <div class="food-item" draggable="true" data-calories="100" data-protein="false" data-src="images/radish.png">ğŸ¥• è˜¿è””</div>
      <div class="food-item" draggable="true" data-calories="300" data-protein="false" data-src="images/rice.png">ğŸš ç™½é£¯</div>
      <div class="food-item" draggable="true" data-calories="200" data-protein="false" data-src="images/vegetable.png">ğŸ¥¦ è”¬èœ</div>
      <div class="food-item" draggable="true" data-calories="400" data-protein="false" data-src="images/bread.png">ğŸ éºµåŒ…</div>
    </div>

    <div class="region" data-goal="0">
      <h3>æ‘èŠ A</h3>
      <img src="images/villageA.png" alt="æ‘èŠ A åœ–ç‰‡" class="village">
      <div class="dropzone" id="zone2-a"></div>
    </div>

    <div class="region" data-goal="0">
      <h3>æ‘èŠ B</h3>
      <img src="images/villageB.png" alt="æ‘èŠ B åœ–ç‰‡" class="village">
      <div class="dropzone" id="zone2-b"></div>
    </div>

    <button onclick="checkLevel2()">ç¢ºèªç‡Ÿé¤Šåˆ†é…</button>
  </div>

  <div id="level3" class="hidden">
    <h2>ç¬¬3é—œï¼šç‡Ÿé¤ŠçŸ¥è­˜æŒ‘æˆ°</h2>
    <p>é»é¸ä»¥ä¸‹é£Ÿç‰©ï¼Œå›ç­”èˆ‡ SDG 2 æœ‰é—œçš„å•é¡Œã€‚ç­”å°è‡³å°‘ 3 é¡Œå³å¯éé—œï¼</p>
    <div id="quiz-foods">
      <div class="quiz-food" onclick="askQuestion(0)">ğŸ¥•</div>
      <div class="quiz-food" onclick="askQuestion(1)">ğŸ—</div>
      <div class="quiz-food" onclick="askQuestion(2)">ğŸ</div>
      <div class="quiz-food" onclick="askQuestion(3)">ğŸš</div>
      <div class="quiz-food" onclick="askQuestion(4)">ğŸ¥¦</div>
    </div>
    <button id="retryBtn" class="hidden" onclick="restartGame()">é‡æ–°æŒ‘æˆ°</button>

  <!-- quiz-popup -->
  <div id="quiz-popup" class="hidden">
    <p id="quiz-question"></p>
    <div id="quiz-options"></div>
  </div>

  <script>
    let correctAnswers = 0;
    const quizAnswered = Array(5).fill(false);
    const quizQuestions = [
      { q: "ä»€éº¼æ˜¯ SDG 2 çš„ä¸»è¦ç›®æ¨™ï¼Ÿ", a: ["æ¶ˆé™¤é£¢é¤“", "æ¸›å°‘ç¢³æ’æ”¾", "æå‡æ•™è‚²æ°´æº–"], correct: 0 },
      { q: "å“ªä¸€ç¨®è¡Œå‹•æœ‰åŠ©æ–¼ç³§é£Ÿå®‰å…¨ï¼Ÿ", a: ["å»ºç«‹åœ¨åœ°è¾²å ´", "æé«˜é€²å£é—œç¨…", "æ¸›å°‘çŒæº‰"], correct: 0 },
      { q: "ä»¥ä¸‹å“ªä¸€é …ä¸æ˜¯è›‹ç™½è³ªä¾†æºï¼Ÿ", a: ["é­š", "ç´…è˜¿è””", "è±†é¡"], correct: 1 },
      { q: "èª°å®¹æ˜“å—åˆ°ç³§é£ŸçŸ­ç¼ºçš„å½±éŸ¿ï¼Ÿ", a: ["åé„‰åœ°å€å±…æ°‘", "å¤§ä¼æ¥­", "å¯Œè£•å®¶åº­"], correct: 0 },
      { q: "ç‚ºä»€éº¼å‡è¡¡é£²é£Ÿå¾ˆé‡è¦ï¼Ÿ", a: ["ä¿ƒé€²å¥åº·èˆ‡æˆé•·", "åªæ˜¯æ½®æµ", "ä¾¿å®œ"], correct: 0 }
    ];

    function askQuestion(index) {
      if (quizAnswered[index]) return;

      const q = quizQuestions[index];
      const popup = document.getElementById('quiz-popup');
      const questionText = document.getElementById('quiz-question');
      const optionsDiv = document.getElementById('quiz-options');

      questionText.textContent = q.q;
      optionsDiv.innerHTML = '';

      q.a.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.textContent = opt;
        btn.onclick = () => handleAnswer(index, i);
        optionsDiv.appendChild(btn);
      });

      popup.classList.remove('hidden');
    }

    function handleAnswer(index, choice) {
      const correct = quizQuestions[index].correct;
      document.getElementById('quiz-popup').classList.add('hidden');

      if (choice === correct) {
        alert("ç­”å°äº†ï¼");
        correctAnswers++;
      } else {
        alert("ç­”éŒ¯äº†ï¼");
      }

      quizAnswered[index] = true;
      document.querySelectorAll('.quiz-food')[index].classList.add('disabled');

      if (correctAnswers >= 3) {
        alert("æ­å–œä½ å®Œæˆç¬¬ä¸‰é—œï¼");
        window.location.href = "level4.html"; // å°å‘ç¬¬å››é—œé é¢
      } else if (quizAnswered.every(x => x)) {
        document.getElementById('retryBtn').classList.remove('hidden');
      }
    }

       function restartGame() {
      location.reload();
    }

    function checkLevel1() {
  document.getElementById("bgm").play();
      let success = true;
      document.querySelectorAll('#level1 .region').forEach(region => {
        const goal = parseInt(region.dataset.goal);
        const total = parseInt(region.querySelector('.total').textContent);
        if (total < goal) success = false;
      });
      if (success) {
        alert("ç¬¬1é—œå®Œæˆï¼");
        document.getElementById('level1').classList.add('hidden');
        document.getElementById('level2').classList.remove('hidden');
      } else {
        alert("è«‹å†æª¢æŸ¥ç†±é‡åˆ†é…ï¼");
      }
    }

    function checkLevel2() {
      let valid = true;
      document.querySelectorAll('#level2 .region').forEach(region => {
        const proteins = region.querySelectorAll('img[data-protein="true"]').length;
        if (proteins === 0) valid = false;
      });
      if (valid) {
        alert("ç¬¬2é—œå®Œæˆï¼");
        document.getElementById('level2').classList.add('hidden');
        document.getElementById('level3').classList.remove('hidden');
      } else {
        alert("æ¯å€‹æ‘èŠéƒ½å¿…é ˆè‡³å°‘åˆ†é…ä¸€ç¨®å«è›‹ç™½è³ªçš„é£Ÿç‰©ï¼");
      }
    }

    document.querySelectorAll('.food-item').forEach(item => {
      item.addEventListener('dragstart', e => {
        e.dataTransfer.setData('calories', item.dataset.calories);
        e.dataTransfer.setData('src', item.dataset.src);
        e.dataTransfer.setData('protein', item.dataset.protein);
        item.classList.add('used');
      });
    });

    document.querySelectorAll('.dropzone').forEach(zone => {
      zone.addEventListener('dragover', e => e.preventDefault());
      zone.addEventListener('drop', e => {
        e.preventDefault();
        const calories = parseInt(e.dataTransfer.getData('calories'));
        const src = e.dataTransfer.getData('src');
        const protein = e.dataTransfer.getData('protein') === 'true';
        const img = document.createElement('img');
        img.src = src;
        img.className = 'food';
        if (protein) img.setAttribute('data-protein', 'true');
        zone.appendChild(img);

        const totalEl = zone.parentElement.querySelector('.total');
        if (totalEl) totalEl.textContent = parseInt(totalEl.textContent) + calories;

        const dragged = [...document.querySelectorAll('.food-item')].find(el => el.dataset.src === src && !el.classList.contains('used-done'));
        if (dragged) {
          dragged.classList.add('used-done');
          dragged.setAttribute('draggable', 'false');
          dragged.style.opacity = '0.5';
        }
      });
    });

  </script>
<audio id="bgm" src="Carefree.mp3" loop hidden></audio>
</body>
</html>